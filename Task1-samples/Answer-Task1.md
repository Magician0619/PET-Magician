==闪烁脉冲信号处理任务==
> 数据下载地址：链接: https://pan.baidu.com/s/1vlh6rLdmQAU_ePxIN7blDg  密码: flch
> 
> 数据的电压采样阈值为：V1=40、V2=110、V3=180、V4=270

# 1、读取二进制Samples文件

.samples文件是二进制的文件，可以使用python的BufferedIOBase.read(size: int) -> bytes函数进行读取。这里面，我们定义每一个事件为544bits，为一帧。将数据提取出来之后，利用unpack函数进行解包.

```python
struct.unpack('<hhdddddddd', binf_single)
```

![image](https://s1.ax1x.com/2020/09/23/wxQVv4.png)

由于`6BDM.samples`文件过大，所以我们只对前10帧数据进行提取,可以得到以下的数据

|  nB | nC | T1 |    T2    |    T3    |    T4    |    T5    |    T6    |    T7    |    T8    |
|:---:|:--:|:--:|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|
| 132 | 36 |  0 |  0.28302 | 0.943405 |  1.69812 | 37.64151 | 51.22643 | 66.32076 | 67.54718 |
| 132 | 55 |  0 | 0.471695 |  1.22641 |  1.4151  | 40.84906 | 55.94341 | 62.54716 | 86.13208 |
| 132 |  3 |  0 | 0.803574 | 1.339279 | 2.946426 | 18.66071 | 42.05357 | 51.78571 | 64.91071 |
| 132 | 28 |  0 | 1.037735 |  2.07547 |  4.05661 | 23.49057 | 47.35849 | 57.73586 | 75.37737 |
| 132 |  5 |  0 | 0.535721 | 1.160721 | 1.964294 | 29.46429 |  33.125  | 62.05357 | 78.92857 |
| 132 | 21 |  0 | 0.446426 |   0.625  | 1.071426 | 40.26785 | 48.92857 | 59.91071 |   73.75  |
| 132 | 30 |  0 | 1.603775 |  2.45282 | 4.622635 | 35.75471 | 47.73584 | 56.03773 | 86.13206 |
| 132 |  5 |  0 | 0.357147 |   0.625  | 0.892853 | 44.01785 | 50.26785 | 52.41071 | 73.83928 |
| 132 | 50 |  0 |  0.84906 | 1.509445 |  2.54718 | 43.67924 | 52.35849 | 61.69812 | 83.39622 |
| 132 | 50 |  0 | 1.037735 | 1.886795 |  3.20755 | 37.54716 | 47.83018 | 62.16982 | 86.22641 |

# 2、对脉冲数据拟合曲线

从获得的数据里面，我们对第一帧数据绘制散点图可以得到

![image](https://s1.ax1x.com/2020/09/23/wxQCEq.png)

这里面我们主要考虑三种曲线`多项式拟合`、`双指数拟合`、`高斯拟合`

1. 多项式拟合

使用多项式曲线进行拟合,经过测试发现5次时拟合效果最佳
```python
poly = np.polyfit(x,y,5) 
```
![多项式曲线](https://s1.ax1x.com/2020/09/23/wxY1w4.png)

2. 双指数拟合

首先先定义函数的类型，可能会存在三种返回值

```python
def double_exp(x,a,b,c,d,e,f):
    '''
    双指数函数曲线
    '''
    return  a*np.exp(b*x)+c*np.exp(d*x)
    # return  a*np.exp(b*x)+c*np.exp(d*x)+e
    # return  a*np.exp(b*x)+c*np.exp(d*x)+e*x+f
```
在这里面我们首先模拟第一种，可以得到图像


3. 高斯分布拟合 

# 3、计算每个脉冲事件的能量（脉冲积分）

可根据第二步中拟合出的脉冲波形所得到的脉冲函数，再对脉冲进行积分运算，求出脉冲所具有的能量，python对一元函数积分可使用Scipy下的integrate函数，只需给出函数的形式以及积分上下限，便可返回积分值与误差。

$$E=\int_{-\infty}^{\infty} s^{2}(t) d t$$

# 4、画出事件能谱

假设脉冲函数为$s(t)$

信号的功率谱密度定义为：
$$P(f)=\lim _{T \rightarrow \infty} \frac{1}{T}\left|S_{T}(f)\right|^{2}$$
# 5、对能谱归一化

对能谱$s(t)$来说，设其中的最大值为$s_{max}$利用线性标准化进行归一化到511kev即：

$$s(t)_{normal} = s(t)\frac{511}{s_{max}}$$


# 6、高斯拟合

# 7、计算能量分辨率


